<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ระบบค้นหารหัสเบิกของ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&family=Noto+Sans+Thai:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans Thai', 'Kanit', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }

        /* Header Styles */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 40px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(30, 60, 114, 0.2);
        }

        .logo-icon i {
            font-size: 28px;
            color: white;
        }

        .logo-text h1 {
            font-size: 28px;
            font-weight: 600;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .logo-text p {
            color: #666;
            font-size: 14px;
            font-weight: 400;
        }

        /* Button Container */
        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 40px;
            max-width: 800px;
            margin: 0 auto;
            padding: 30px;
        }

        .button-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .button-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }

        .button-card.search {
            border-top: 5px solid #3498db;
        }

        .button-card.staff {
            border-top: 5px solid #2ecc71;
        }

        .icon-wrapper {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 25px;
            font-size: 42px;
            color: white;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        .search .icon-wrapper {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .staff .icon-wrapper {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        .button-card h2 {
            font-size: 28px;
            margin-bottom: 15px;
            font-weight: 600;
            color: #2c3e50;
        }

        .button-card p {
            font-size: 16px;
            color: #666;
            margin-bottom: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .btn {
            display: inline-block;
            padding: 16px 40px;
            font-size: 18px;
            font-weight: 500;
            border-radius: 50px;
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-family: 'Noto Sans Thai', 'Kanit', sans-serif;
            min-width: 200px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn-search {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }

        .btn-search:hover {
            background: linear-gradient(135deg, #2980b9 0%, #1f639b 100%);
            transform: scale(1.05);
        }

        .btn-staff {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }

        .btn-staff:hover {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            transform: scale(1.05);
        }

        /* Footer Styles */
        footer {
            margin-top: 60px;
            padding: 25px 0;
            text-align: center;
            color: #666;
            font-size: 14px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        /* Responsive Design */
        @media (min-width: 768px) {
            .button-container {
                flex-direction: row;
                justify-content: center;
                gap: 50px;
            }
            
            .button-card {
                width: 380px;
            }
            
            .logo-text h1 {
                font-size: 32px;
            }
        }

        @media (max-width: 767px) {
            header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .button-card {
                padding: 30px 20px;
            }
            
            .icon-wrapper {
                width: 80px;
                height: 80px;
                font-size: 34px;
            }
            
            .button-card h2 {
                font-size: 24px;
            }
        }

        /* Footer */
    footer {
      text-align: center;
      padding: 30px;
      color: var(--gray-color);
      font-size: 0.9rem;
      border-top: 1px solid #eee;
      background-color: rgba(248, 249, 250, 0.8);
    }
    
    footer p {
      margin-bottom: 8px;
    }
    
    .footer-links {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
    }
    
    .footer-links a {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
    }
    
    .footer-links a:hover {
      color: var(--secondary-color);
      text-decoration: underline;
    }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="logo-text">
                    <h1>ระบบค้นหารหัสเบิกของ</h1>
                    <p>Code Item Inventory System</p>
                </div>
            </div>
        </header>

        <main>
            <div class="button-container">
                <div class="button-card search">
                    <div class="icon-wrapper">
                        <i class="fas fa-search"></i>
                    </div>
                    <h2>ค้นหาพัสดุ</h2>
                    <p>ค้นหาข้อมูลพัสดุ ค้นหารหัสเบิกของ</p>
                    <a href="<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบค้นหารหัสเบิกของ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: #333;
      line-height: 1.6;
      padding: 20px;
    }
    
    .container {
      max-width: 1600px;
      margin: 0 auto;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    header {
      background: linear-gradient(135deg, #2c3e50, #3498db);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
    }
    
    .subtitle {
      font-size: 1rem;
      opacity: 0.9;
    }
    
    .search-section {
      padding: 30px;
      border-bottom: 1px solid #eaeaea;
    }
    
    .search-form {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: flex-end;
    }
    
    .form-group {
      flex: 1;
      min-width: 250px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
    }
    
    input[type="text"], select {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
      transition: border-color 0.3s;
    }
    
    input[type="text"]:focus, select:focus {
      border-color: #3498db;
      outline: none;
    }
    
    button {
      padding: 12px 30px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s;
      height: 46px;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    .results-section {
      padding: 20px;
    }
    
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    #results-count {
      font-weight: 600;
      color: #2c3e50;
    }
    
    #clear-btn {
      background-color: #e74c3c;
    }
    
    #clear-btn:hover {
      background-color: #c0392b;
    }
    
    .table-container {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    th {
      background-color: #f8f9fa;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #2c3e50;
      border-bottom: 2px solid #dee2e6;
      position: sticky;
      top: 0;
    }
    
    td {
      padding: 15px;
      border-bottom: 1px solid #dee2e6;
      vertical-align: top;
    }
    
    tr:hover {
      background-color: #f8f9fa;
    }
    
    .no-results {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
      font-size: 1.1rem;
    }
    
    .loading {
      text-align: center;
      padding: 30px;
      display: none;
    }
    
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid #3498db;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* สไตล์สำหรับรูปภาพ */
    .product-image {
      width: 70px;
      height: 70px;
      object-fit: cover;
      border-radius: 6px;
      border: 1px solid #eaeaea;
      background-color: #f9f9f9;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .product-image:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
      border-color: #3498db;
    }
    
    .product-image.active {
      border: 2px solid #2ecc71;
      transform: scale(1.05);
    }
    
    .no-image {
      width: 70px;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #f5f7fa, #e4e8f0);
      border-radius: 6px;
      color: #7f8c8d;
      font-size: 11px;
      text-align: center;
      padding: 10px;
      border: 2px dashed #cbd5e0;
    }
    
    .image-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .image-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      max-width: 240px;
    }
    
    .image-grid.col-5 {
      grid-template-columns: repeat(5, 1fr);
      max-width: 400px;
    }
    
    .image-grid.col-4 {
      grid-template-columns: repeat(4, 1fr);
      max-width: 320px;
    }
    
    .image-grid.col-3 {
      grid-template-columns: repeat(3, 1fr);
      max-width: 240px;
    }
    
    .image-grid.col-2 {
      grid-template-columns: repeat(2, 1fr);
      max-width: 160px;
    }
    
    .image-grid.col-1 {
      grid-template-columns: repeat(1, 1fr);
      max-width: 80px;
    }
    
    .image-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .image-number {
      font-size: 10px;
      color: #666;
      background-color: #f1f3f5;
      padding: 2px 6px;
      border-radius: 10px;
      font-weight: 500;
    }
    
    .more-images {
      font-size: 10px;
      color: #e74c3c;
      background-color: #ffebee;
      padding: 2px 8px;
      border-radius: 10px;
      margin-top: 5px;
      font-weight: 500;
    }
    
    /* สไตล์สำหรับ modal รูปภาพขยาย */
    .image-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.95);
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    
    .modal-top-bar {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      color: white;
      font-size: 1.1rem;
      font-weight: 500;
    }
    
    .close-modal {
      color: white;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
      background: none;
      border: none;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .close-modal:hover {
      color: #f1f1f1;
      transform: scale(1.1);
    }
    
    .modal-content {
      max-width: 85%;
      max-height: 70%;
      margin-top: 60px;
    }
    
    .modal-content img {
      width: 100%;
      height: auto;
      max-height: 70vh;
      object-fit: contain;
      border-radius: 8px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }
    
    .modal-controls {
      position: absolute;
      bottom: 30px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    
    .nav-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      backdrop-filter: blur(5px);
    }
    
    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: scale(1.1);
    }
    
    .image-counter {
      color: white;
      background: rgba(0, 0, 0, 0.7);
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
    }
    
    .thumbnail-container {
      position: absolute;
      bottom: 100px;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px;
      overflow-x: auto;
      max-width: 90%;
      margin: 0 auto;
    }
    
    .thumbnail {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 6px;
      cursor: pointer;
      opacity: 0.6;
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    
    .thumbnail:hover {
      opacity: 0.8;
      transform: translateY(-2px);
    }
    
    .thumbnail.active {
      opacity: 1;
      border: 2px solid #3498db;
      box-shadow: 0 0 10px rgba(52, 152, 219, 0.5);
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 30px;
      color: #7f8c8d;
      font-size: 0.9rem;
      border-top: 1px solid #eee;
      background-color: rgba(248, 249, 250, 0.8);
    }
    
    footer p {
      margin-bottom: 8px;
    }
    
    @media (max-width: 1200px) {
      .container {
        max-width: 100%;
      }
      
      .image-grid.col-5 {
        grid-template-columns: repeat(3, 1fr);
        max-width: 240px;
      }
      
      .image-grid.col-4 {
        grid-template-columns: repeat(3, 1fr);
        max-width: 240px;
      }
    }
    
    @media (max-width: 768px) {
      .search-form {
        flex-direction: column;
        align-items: stretch;
      }
      
      .form-group {
        width: 100%;
      }
      
      button {
        width: 100%;
      }
      
      header {
        padding: 20px;
      }
      
      h1 {
        font-size: 1.8rem;
      }
      
      .product-image {
        width: 60px;
        height: 60px;
      }
      
      .no-image {
        width: 60px;
        height: 60px;
      }
      
      .image-grid.col-5,
      .image-grid.col-4,
      .image-grid.col-3 {
        grid-template-columns: repeat(2, 1fr);
        max-width: 140px;
      }
      
      .modal-content {
        max-width: 95%;
        max-height: 60%;
      }
      
      .thumbnail {
        width: 40px;
        height: 40px;
      }
      
      .nav-btn {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
    }
  </style>
  <!-- เพิ่ม Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="container">
    <header>
      <h1>ระบบค้นหารหัสเบิกของ</h1>
      <p class="subtitle">ค้นหารหัสเบิกของาจากรหัสหรือรายละเอียด พร้อมแสดงรูปภาพสินค้า </p>
    </header>
    
    <section class="search-section">
      <form id="searchForm" class="search-form">
        <div class="form-group">
          <label for="searchType">ประเภทการค้นหา:</label>
          <select id="searchType">
            <option value="all">ค้นหาทั้งรหัสและรายละเอียด</option>
            <option value="code">ค้นหาจากรหัสสินค้า</option>
            <option value="detail">ค้นหาจากรายละเอียด/คำค้นหา</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="searchTerm">คำค้นหา:</label>
          <input type="text" id="searchTerm" placeholder="กรอกรหัสหรือคำค้นหา..." required>
        </div>
        
        <div class="form-group">
          <button type="submit">ค้นหา</button>
        </div>
      </form>
    </section>
    
    <section class="results-section">
      <div class="results-header">
        <div id="results-count">พบ 0 รายการ</div>
        <button id="clear-btn" style="display:none;">ล้างผลลัพธ์</button>
      </div>
      
      <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>กำลังค้นหา...</p>
      </div>
      
      <div class="table-container">
        <table id="results-table">
          <thead>
            <tr>
              <th width="5%">ลำดับ</th>
              <th width="12%">รหัส Express</th>
              <th width="15%">ITEMS</th>
              <th width="33%">รายละเอียด</th>
              <th width="10%">หน่วย</th>
              <th width="25%">รูปภาพ</th>
            </tr>
          </thead>
          <tbody id="results-body">
            <!-- ผลลัพธ์จะแสดงที่นี่ -->
          </tbody>
        </table>
        <div id="no-results" class="no-results" style="display:none;">
          <p>ไม่พบข้อมูลที่ค้นหา</p>
        </div>
      </div>
    </section>
    
    <!-- Modal สำหรับแสดงรูปภาพขยาย -->
    <div id="imageModal" class="image-modal">
      <div class="modal-top-bar">
        <div class="modal-title" id="modalTitle">รูปภาพสินค้า</div>
        <button class="close-modal">&times;</button>
      </div>
      
      <div class="modal-content">
        <img id="expandedImage" src="" alt="รูปภาพสินค้า">
      </div>
      
      <div class="thumbnail-container" id="thumbnailContainer">
        <!-- thumbnail จะถูกเพิ่มโดย JavaScript -->
      </div>
      
      <div class="modal-controls">
        <button class="nav-btn" id="prevBtn">
          <i class="fas fa-chevron-left"></i>
        </button>
        
        <div class="image-counter" id="imageCounter">รูปที่ 1 จาก 5</div>
        
        <button class="nav-btn" id="nextBtn">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
    
    <footer>
      <p>ระบบค้นหารหัสเบิกของ  © 2026 | พัฒนาโดย Sarawut.C</p>
      <p>สำหรับใช้ภายในองค์กรเท่านั้น </p>
    </footer>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const searchForm = document.getElementById('searchForm');
      const searchType = document.getElementById('searchType');
      const searchTerm = document.getElementById('searchTerm');
      const resultsBody = document.getElementById('results-body');
      const resultsCount = document.getElementById('results-count');
      const loadingDiv = document.getElementById('loading');
      const noResultsDiv = document.getElementById('no-results');
      const clearBtn = document.getElementById('clear-btn');
      const resultsTable = document.getElementById('results-table');
      
      // Modal elements
      const imageModal = document.getElementById('imageModal');
      const expandedImage = document.getElementById('expandedImage');
      const closeModal = document.querySelector('.close-modal');
      const imageCounter = document.getElementById('imageCounter');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const thumbnailContainer = document.getElementById('thumbnailContainer');
      const modalTitle = document.getElementById('modalTitle');
      
      // ตัวแปรสำหรับจัดการภาพใน modal
      let currentImages = [];
      let currentImageIndex = 0;
      let currentProductInfo = {};
      
      // จัดการการส่งฟอร์มค้นหา
      searchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const type = searchType.value;
        const term = searchTerm.value.trim();
        
        if (!term) {
          alert('กรุณากรอกคำค้นหา');
          return;
        }
        
        // แสดงโหลดดิ้ง
        loadingDiv.style.display = 'block';
        resultsBody.innerHTML = '';
        noResultsDiv.style.display = 'none';
        clearBtn.style.display = 'none';
        
        // เรียกฟังก์ชันค้นหา
        if (typeof google !== 'undefined' && google.script && google.script.run) {
          google.script.run.withSuccessHandler(displayResults).searchData(type, term);
        } else {
          console.error('Google Apps Script API not available');
          loadingDiv.style.display = 'none';
          alert('ไม่สามารถเชื่อมต่อกับเซิร์ฟเวอร์ได้');
        }
      });
      
      // ฟังก์ชันแสดงผลลัพธ์
      function displayResults(results) {
        loadingDiv.style.display = 'none';
        
        if (results.error) {
          alert('เกิดข้อผิดพลาด: ' + results.error);
          return;
        }
        
        if (!results || results.length === 0) {
          resultsCount.textContent = 'พบ 0 รายการ';
          noResultsDiv.style.display = 'block';
          resultsTable.style.display = 'none';
          clearBtn.style.display = 'block';
          return;
        }
        
        // แสดงตารางผลลัพธ์
        resultsTable.style.display = 'table';
        resultsBody.innerHTML = '';
        
        results.forEach((item, index) => {
          const row = document.createElement('tr');
          
          row.innerHTML = `
            <td>${item.index || index + 1}</td>
            <td>${escapeHtml(item.code || '-')}</td>
            <td>${escapeHtml(item.item || '-')}</td>
            <td>${escapeHtml(item.detail || '-')}</td>
            <td>${escapeHtml(item.unit || '-')}</td>
            <td>
              ${getImageHTML(item, index)}
            </td>
          `;
          
          resultsBody.appendChild(row);
        });
        
        // เพิ่ม event listeners สำหรับรูปภาพ
        addImageEventListeners();
        
        // อัพเดทจำนวนผลลัพธ์
        resultsCount.textContent = `พบ ${results.length} รายการ`;
        clearBtn.style.display = 'block';
      }
      
      // ฟังก์ชันสร้าง HTML สำหรับรูปภาพ (รองรับสูงสุด 5 รูป)
      function getImageHTML(item, rowIndex) {
        // แยก URL รูปภาพ (คั่นด้วย | หรือ ,)
        let imageUrls = [];
        
        if (item.imageUrl && item.imageUrl.trim() !== '') {
          // ลองแยกด้วย |
          if (item.imageUrl.includes('|')) {
            imageUrls = item.imageUrl.split('|').map(url => url.trim()).filter(url => url !== '');
          }
          // ลองแยกด้วย ,
          else if (item.imageUrl.includes(',')) {
            imageUrls = item.imageUrl.split(',').map(url => url.trim()).filter(url => url !== '');
          }
          // ถ้ามีแค่ URL เดียว
          else {
            imageUrls = [item.imageUrl.trim()];
          }
        }
        
        // กรองเฉพาะ URL ที่ถูกต้อง
        const validUrls = imageUrls.filter(url => 
          url && 
          (url.startsWith('http://') || url.startsWith('https://'))
        ).slice(0, 5); // จำกัดสูงสุด 5 รูป
        
        if (validUrls.length === 0) {
          return `
            <div class="image-container">
              <div class="no-image">
                <div>ไม่มีรูปภาพ</div>
              </div>
            </div>
          `;
        }
        
        // กำหนดคลาส grid ตามจำนวนรูปภาพ
        const gridClass = getGridClass(validUrls.length);
        
        // สร้าง HTML สำหรับรูปภาพ
        const imagesHTML = `
          <div class="image-container" data-row-index="${rowIndex}">
            <div class="image-grid ${gridClass}">
              ${validUrls.map((url, idx) => `
                <div class="image-item">
                  <img src="${encodeURI(url)}" 
                       alt="รูปที่ ${idx + 1}" 
                       class="product-image" 
                       data-image-index="${idx}"
                       data-row-index="${rowIndex}"
                       title="รูปที่ ${idx + 1} - คลิกเพื่อดูขนาดใหญ่">
                  <div class="image-number">${idx + 1}</div>
                </div>
              `).join('')}
            </div>
            ${imageUrls.length > 5 ? `<div class="more-images">+ อีก ${imageUrls.length - 5} รูป</div>` : ''}
          </div>
        `;
        
        return imagesHTML;
      }
      
      // ฟังก์ชันกำหนดคลาส grid ตามจำนวนรูปภาพ
      function getGridClass(count) {
        if (count === 1) return 'col-1';
        if (count === 2) return 'col-2';
        if (count === 3) return 'col-3';
        if (count === 4) return 'col-4';
        if (count >= 5) return 'col-5';
        return 'col-1';
      }
      
      // ฟังก์ชัน escape HTML
      function escapeHtml(text) {
        const map = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, function(m) { return map[m]; });
      }
      
      // เพิ่ม event listeners สำหรับรูปภาพ
      function addImageEventListeners() {
        const productImages = document.querySelectorAll('.product-image');
        productImages.forEach(img => {
          img.addEventListener('click', function() {
            const rowIndex = parseInt(this.getAttribute('data-row-index') || 0);
            const imageIndex = parseInt(this.getAttribute('data-image-index') || 0);
            
            // หาข้อมูลสินค้าจากแถว
            const row = document.querySelector(`tr:nth-child(${rowIndex + 1})`);
            if (row) {
              const code = row.cells[1].textContent;
              const item = row.cells[2].textContent;
              currentProductInfo = { code, item };
            }
            
            // หา URL รูปภาพทั้งหมดจากแถวนี้
            const imageContainer = this.closest('.image-container');
            const imageItems = imageContainer.querySelectorAll('.product-image');
            const allImages = Array.from(imageItems).map(img => img.src.replace(/^.*?src=/, ''));
            
            // ตั้งค่ารูปภาพที่จะแสดงใน modal
            currentImages = allImages;
            currentImageIndex = imageIndex;
            
            // แสดง modal
            openImageModal();
          });
        });
      }
      
      // เปิด modal รูปภาพ
      function openImageModal() {
        if (currentImages.length === 0) return;
        
        // ตั้งค่ารูปภาพแรก
        showImageInModal(currentImageIndex);
        
        // สร้าง thumbnail
        createThumbnails();
        
        // ตั้งค่า modal title
        modalTitle.textContent = `รูปภาพสินค้า: ${currentProductInfo.code || ''} - ${currentProductInfo.item || ''}`;
        
        // แสดง modal
        imageModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
      }
      
      // แสดงรูปภาพใน modal
      function showImageInModal(index) {
        if (currentImages.length === 0 || index < 0 || index >= currentImages.length) {
          return;
        }
        
        currentImageIndex = index;
        expandedImage.src = currentImages[index];
        imageCounter.textContent = `รูปที่ ${index + 1} จาก ${currentImages.length}`;
        
        // อัพเดท thumbnail ที่ active
        updateActiveThumbnail();
      }
      
      // สร้าง thumbnail
      function createThumbnails() {
        thumbnailContainer.innerHTML = '';
        
        currentImages.forEach((url, index) => {
          const thumbnail = document.createElement('img');
          thumbnail.src = url;
          thumbnail.className = `thumbnail ${index === currentImageIndex ? 'active' : ''}`;
          thumbnail.alt = `รูปที่ ${index + 1}`;
          thumbnail.addEventListener('click', () => {
            showImageInModal(index);
          });
          thumbnailContainer.appendChild(thumbnail);
        });
      }
      
      // อัพเดท thumbnail ที่ active
      function updateActiveThumbnail() {
        const thumbnails = thumbnailContainer.querySelectorAll('.thumbnail');
        thumbnails.forEach((thumb, index) => {
          thumb.classList.toggle('active', index === currentImageIndex);
        });
      }
      
      // เปลี่ยนรูปภาพใน modal
      function changeImage(direction) {
        if (currentImages.length <= 1) return;
        
        let newIndex = currentImageIndex + direction;
        
        // วนกลับไปเริ่มต้นหรือท้ายสุด
        if (newIndex < 0) {
          newIndex = currentImages.length - 1;
        } else if (newIndex >= currentImages.length) {
          newIndex = 0;
        }
        
        showImageInModal(newIndex);
      }
      
      // จัดการปุ่มล้างผลลัพธ์
      clearBtn.addEventListener('click', function() {
        resultsBody.innerHTML = '';
        resultsCount.textContent = 'พบ 0 รายการ';
        noResultsDiv.style.display = 'none';
        resultsTable.style.display = 'table';
        clearBtn.style.display = 'none';
        searchTerm.value = '';
        searchTerm.focus();
      });
      
      // จัดการ modal รูปภาพ
      closeModal.addEventListener('click', function() {
        closeImageModal();
      });
      
      // ปิด modal
      function closeImageModal() {
        imageModal.style.display = 'none';
        document.body.style.overflow = 'auto';
        currentImages = [];
        currentImageIndex = 0;
      }
      
      // ปิด modal เมื่อคลิกพื้นหลัง
      imageModal.addEventListener('click', function(e) {
        if (e.target === imageModal) {
          closeImageModal();
        }
      });
      
      // ปุ่มนำทางรูปภาพ
      prevBtn.addEventListener('click', function() {
        changeImage(-1);
      });
      
      nextBtn.addEventListener('click', function() {
        changeImage(1);
      });
      
      // เพิ่มการกดปุ่มลูกศรซ้าย/ขวาเพื่อเปลี่ยนรูป
      document.addEventListener('keydown', function(e) {
        if (imageModal.style.display === 'flex') {
          if (e.key === 'ArrowLeft') {
            changeImage(-1);
          } else if (e.key === 'ArrowRight') {
            changeImage(1);
          } else if (e.key === 'Escape') {
            closeImageModal();
          }
        }
      });
      
      // ให้ฟอร์ม focus ที่ช่องค้นหา
      searchTerm.focus();
    });
    
    // ฟังก์ชัน fallback ถ้า google.script ไม่พร้อม
    if (typeof google === 'undefined') {
      console.warn('Google Apps Script API not loaded. Using mock data for testing.');
      
      // ฟังก์ชันจำลองสำหรับทดสอบ
      window.mockSearchData = function(type, term) {
        console.log('Mock search called:', type, term);
        
        // ข้อมูลตัวอย่าง (มีหลายรูป สูงสุด 5 รูป)
        const mockResults = [
          {
            index: 1,
            code: 'EX001',
            item: 'สินค้าตัวอย่าง 1 (5 รูป)',
            detail: 'รายละเอียดสินค้าตัวอย่าง 1 พร้อมรูปภาพครบ 5 รูป',
            unit: 'ชิ้น',
            imageUrl: 'https://via.placeholder.com/150/3498db/ffffff?text=1|https://via.placeholder.com/150/2ecc71/ffffff?text=2|https://via.placeholder.com/150/e74c3c/ffffff?text=3|https://via.placeholder.com/150/f39c12/ffffff?text=4|https://via.placeholder.com/150/9b59b6/ffffff?text=5'
          },
          {
            index: 2,
            code: 'EX002',
            item: 'สินค้าตัวอย่าง 2 (3 รูป)',
            detail: 'รายละเอียดสินค้าตัวอย่าง 2 พร้อม 3 รูปภาพ',
            unit: 'กล่อง',
            imageUrl: 'https://via.placeholder.com/150/1abc9c/ffffff?text=A|https://via.placeholder.com/150/34495e/ffffff?text=B|https://via.placeholder.com/150/e67e22/ffffff?text=C'
          },
          {
            index: 3,
            code: 'EX003',
            item: 'สินค้าตัวอย่าง 3 (1 รูป)',
            detail: 'รายละเอียดสินค้าตัวอย่าง 3 มีรูปภาพเดียว',
            unit: 'ชิ้น',
            imageUrl: 'https://via.placeholder.com/150/3498db/ffffff?text=Single'
          },
          {
            index: 4,
            code: 'EX004',
            item: 'สินค้าตัวอย่าง 4 (ไม่มีรูป)',
            detail: 'รายละเอียดสินค้าตัวอย่าง 4 ไม่มีรูปภาพ',
            unit: 'ชิ้น',
            imageUrl: ''
          }
        ];
        
        // กรองตามคำค้นหา
        const filteredResults = mockResults.filter(item => {
          const searchLower = term.toLowerCase();
          const codeLower = item.code.toLowerCase();
          const itemLower = item.item.toLowerCase();
          const detailLower = item.detail.toLowerCase();
          
          if (type === 'code') return codeLower.includes(searchLower);
          if (type === 'detail') return itemLower.includes(searchLower) || detailLower.includes(searchLower);
          return codeLower.includes(searchLower) || itemLower.includes(searchLower) || detailLower.includes(searchLower);
        });
        
        return filteredResults;
      };
      
      // จำลอง google.script.run
      if (!window.google) window.google = {};
      if (!google.script) google.script = {};
      if (!google.script.run) {
        google.script.run = {
          withSuccessHandler: function(handler) {
            this.successHandler = handler;
            return this;
          },
          searchData: function(type, term) {
            setTimeout(() => {
              const results = window.mockSearchData(type, term);
              if (this.successHandler) {
                this.successHandler(results);
              }
            }, 500);
            return this;
          }
        };
      }
    }
  </script>
</body>
</html>" class="btn btn-search" target="_blank">
                        <i class="fas fa-search"></i> คลิกเพื่อค้นหา
                    </a>
                </div>

                <div class="button-card staff">
                    <div class="icon-wrapper">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <h2>เจ้าหน้าที่คลังพัสดุ</h2>
                    <p>สำหรับเจ้าหน้าที่คลังพัสดุ เพื่อบันทึกข้อมูลพัสดุและจัดการระบบ</p>
                    <a href="https://sarawutc6689-cpu.github.io/Mouldmate-ST/Login.html" class="btn btn-staff" target="_blank">
                        <i class="fas fa-user-tie"></i> เข้าสู่ระบบเจ้าหน้าที่
                    </a>
                </div>
            </div>
        </main>
    </div>

    <footer>
        <div class="container">
            <p>ระบบค้นหารหัสเบิกของ © 2026 แผนกคลังพัสดุ | Store Department</p>
            <p>สำหรับใช้ในการทำงานภายในบริษัทเท่านั้น</p>
            <p>พัฒนาโดย Sarawut.C</p>
        </div>
    </footer>

    <script>
        // เพิ่มเอฟเฟกต์เมื่อโหลดหน้าเว็บ
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.button-card');
            
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, 300 + (index * 200));
            });
            
            // เพิ่มการยืนยันเมื่อคลิกปุ่มเจ้าหน้าที่
            const staffBtn = document.querySelector('.btn-staff');
            if(staffBtn) {
                staffBtn.addEventListener('click', function(e) {
                    const confirmed = confirm("หน้านี้สำหรับเจ้าหน้าที่คลังพัสดุเท่านั้น\nคุณแน่ใจว่าต้องการเข้าสู่ระบบเจ้าหน้าที่?");
                    if(!confirmed) {
                        e.preventDefault();
                    }
                });
            }
        });
    </script>
</body>
</html>
